<!-- ========================================
  HYTOPIA SDK-COMPLIANT MOBILE CONTROLS

  This file contains simple mobile action buttons that work
  with Hytopia's automatic mobile movement and camera controls.

  Hytopia automatically provides:
  - Movement joystick (left 40% of screen)
  - Camera controls (right 60% of screen)

  We only need to add custom action buttons.
======================================== -->

<!-- Mobile Action Buttons Container -->
<div class="mobile-controls">
  <!-- Shoot Button (Right side) -->
  <button id="mobile-shoot-btn" class="mobile-button mobile-shoot">
    <span class="mobile-button-icon">O</span>
    <span class="mobile-button-label">SHOOT</span>
  </button>

  <!-- Pass Button (Right side) -->
  <button id="mobile-pass-btn" class="mobile-button mobile-pass">
    <span class="mobile-button-icon">></span>
    <span class="mobile-button-label">PASS</span>
  </button>

  <!-- Sprint Button (Left side) -->
  <button id="mobile-sprint-btn" class="mobile-button mobile-sprint">
    <span class="mobile-button-icon">!</span>
    <span class="mobile-button-label">SPRINT</span>
  </button>

  <!-- Tackle Button (Right side) -->
  <button id="mobile-tackle-btn" class="mobile-button mobile-tackle">
    <span class="mobile-button-icon">#</span>
    <span class="mobile-button-label">TACKLE</span>
  </button>
</div>

<style>
  /* ========================================
     MOBILE CONTROLS - SDK COMPLIANT
     ======================================== */

  /* Hide mobile controls by default */
  .mobile-controls {
    display: none;
  }

  /* Show mobile controls only when Hytopia detects mobile device */
  body.mobile .mobile-controls {
    display: block !important;
    position: fixed;
    bottom: 0;
    left: 0;
    right: 0;
    width: 100%;
    height: auto;
    pointer-events: none; /* Allow touch-through to Hytopia's controls */
    z-index: 1000;
  }

  /* Mobile Button Base Styles */
  body.mobile .mobile-button {
    position: fixed;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    width: 70px;
    height: 70px;
    border-radius: 50%;
    background: rgba(0, 0, 0, 0.7);
    border: 3px solid rgba(255, 255, 255, 0.3);
    backdrop-filter: blur(10px);
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.5);
    transition: all 0.15s ease;
    pointer-events: auto; /* Enable touch for buttons */
    cursor: pointer;
    user-select: none;
    -webkit-tap-highlight-color: transparent;
    touch-action: manipulation;
  }

  /* Button pressed state */
  body.mobile .mobile-button:active,
  body.mobile .mobile-button.active {
    transform: scale(0.9);
    background: rgba(0, 0, 0, 0.9);
    border-color: rgba(255, 255, 255, 0.6);
    box-shadow: 0 2px 6px rgba(0, 0, 0, 0.7);
  }

  /* Button Icon */
  body.mobile .mobile-button-icon {
    font-size: 28px;
    margin-bottom: 2px;
    filter: drop-shadow(0 2px 4px rgba(0, 0, 0, 0.8));
  }

  /* Button Label */
  body.mobile .mobile-button-label {
    font-size: 9px;
    font-weight: bold;
    color: rgba(255, 255, 255, 0.9);
    text-transform: uppercase;
    letter-spacing: 0.5px;
    text-shadow: 0 1px 3px rgba(0, 0, 0, 0.8);
  }

  /* ========================================
     BUTTON POSITIONING (Landscape Mode)
     ======================================== */

  /* Shoot Button - Bottom right */
  body.mobile .mobile-shoot {
    bottom: 80px;
    right: 30px;
    background: linear-gradient(135deg, rgba(220, 50, 50, 0.8), rgba(180, 30, 30, 0.8));
  }

  body.mobile .mobile-shoot:active {
    background: linear-gradient(135deg, rgba(250, 70, 70, 0.9), rgba(200, 40, 40, 0.9));
  }

  /* Pass Button - Bottom right, above shoot */
  body.mobile .mobile-pass {
    bottom: 170px;
    right: 30px;
    background: linear-gradient(135deg, rgba(50, 150, 255, 0.8), rgba(30, 120, 200, 0.8));
  }

  body.mobile .mobile-pass:active {
    background: linear-gradient(135deg, rgba(70, 170, 255, 0.9), rgba(40, 140, 220, 0.9));
  }

  /* Sprint Button - Bottom left */
  body.mobile .mobile-sprint {
    bottom: 80px;
    left: 30px;
    background: linear-gradient(135deg, rgba(255, 200, 50, 0.8), rgba(220, 160, 30, 0.8));
  }

  body.mobile .mobile-sprint:active {
    background: linear-gradient(135deg, rgba(255, 220, 70, 0.9), rgba(240, 180, 40, 0.9));
  }

  /* Tackle Button - Mid right */
  body.mobile .mobile-tackle {
    bottom: 260px;
    right: 30px;
    background: linear-gradient(135deg, rgba(150, 80, 255, 0.8), rgba(120, 60, 200, 0.8));
  }

  body.mobile .mobile-tackle:active {
    background: linear-gradient(135deg, rgba(170, 100, 255, 0.9), rgba(140, 80, 220, 0.9));
  }

  /* ========================================
     SMALLER SCREENS (Tablets/Small Phones)
     ======================================== */

  @media (max-height: 600px) {
    body.mobile .mobile-button {
      width: 60px;
      height: 60px;
    }

    body.mobile .mobile-button-icon {
      font-size: 24px;
    }

    body.mobile .mobile-button-label {
      font-size: 8px;
    }

    body.mobile .mobile-shoot {
      bottom: 60px;
      right: 20px;
    }

    body.mobile .mobile-pass {
      bottom: 135px;
      right: 20px;
    }

    body.mobile .mobile-sprint {
      bottom: 60px;
      left: 20px;
    }

    body.mobile .mobile-tackle {
      bottom: 210px;
      right: 20px;
    }
  }
</style>

<script>
  // ========================================
  // MOBILE CONTROLS JAVASCRIPT
  // SDK-Compliant using hytopia.pressInput()
  // ========================================

  // Only initialize if we're on mobile (Hytopia adds .mobile class to body)
  if (document.body.classList.contains('mobile') || hytopia.isMobile) {
    console.log('ðŸ“± Initializing mobile controls (SDK-compliant)');

    // Helper function to handle button press/release
    function setupMobileButton(buttonId, inputKey) {
      const button = document.getElementById(buttonId);
      if (!button) {
        console.warn(`Mobile button ${buttonId} not found`);
        return;
      }

      // Touch start - press the input
      button.addEventListener('touchstart', (e) => {
        e.preventDefault(); // Prevent mobile browser behaviors
        button.classList.add('active');
        hytopia.pressInput(inputKey, true); // SDK method to press input
        console.log(`ðŸ“± Mobile: ${buttonId} pressed (${inputKey})`);
      });

      // Touch end - release the input
      button.addEventListener('touchend', (e) => {
        e.preventDefault();
        button.classList.remove('active');
        hytopia.pressInput(inputKey, false); // SDK method to release input
        console.log(`ðŸ“± Mobile: ${buttonId} released (${inputKey})`);
      });

      // Touch cancel (finger leaves button) - also release
      button.addEventListener('touchcancel', (e) => {
        e.preventDefault();
        button.classList.remove('active');
        hytopia.pressInput(inputKey, false);
      });
    }

    // Setup all mobile buttons
    // These map to the same input keys that desktop players use
    setupMobileButton('mobile-shoot-btn', 'mr');  // Right mouse button = Shoot
    setupMobileButton('mobile-pass-btn', 'ml');   // Left mouse button = Pass
    setupMobileButton('mobile-sprint-btn', 'sh'); // Shift key = Sprint
    setupMobileButton('mobile-tackle-btn', 'e');  // E key = Tackle

    console.log('[OK] Mobile controls initialized successfully');
  }
</script>
